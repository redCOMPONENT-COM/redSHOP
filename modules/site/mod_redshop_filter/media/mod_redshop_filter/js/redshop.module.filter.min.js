!function(e){var r=window.redSHOP||{};r.Module=r.Module||{},r.Module.Filter=r.Module.Filter||{},r.Module.Filter.form=null,r.Module.Filter.priceSlider=null,r.Module.Filter.options={},r.Module.Filter.resetMode=!1,r.Module.Filter.setup=function(i){r.Module.Filter.options=i,r.Module.Filter.form=e("#redproductfinder-form-"+r.Module.Filter.options.domId),r.Module.Filter.checkList(),"1"===i.moduleParams.manufacturer&&r.Module.Filter.form.find('input[name="keyword-manufacturer"]').on("keyup",function(e){if(13===e.keyCode)return!1;r.Module.Filter.populateManufacturerOptions()}),r.Module.Filter.form.find('[type="checkbox"]').each(function(){r.Module.Filter.checkClick(e(this))}),r.Module.Filter.form.html(function(){e("span.label_alias").click(function(){e(this).hasClass("active")?e(this).removeClass("active").next("ul.collapse").removeClass("in"):(r.Module.Filter.form.find("ul.collapse.in").removeClass("in").prev("span").removeClass("active"),e(this).addClass("active").next("ul.collapse").addClass("in"))}),"1"===i.moduleParams.price&&(r.Module.Filter.rangeSlide(i.rangeMin,i.rangeMax,i.currentMin,i.currentMax,r.Module.Filter.submitFormAjax),r.Module.Filter.form.find("input[name='redform[filterprice][min]']").on("keypress",function(i){if(13===i.keyCode){var l=[e(this).val(),r.Module.Filter.form.find("input[name='redform[filterprice][max]']").val()];return r.Module.Filter.form.find("#slider-range").slider("values",l),!1}return!0}),r.Module.Filter.form.find("input[name='redform[filterprice][max]']").on("keypress",function(i){if(13===i.keyCode){var l=[r.Module.Filter.form.find("input[name='redform[filterprice][min]']").val(),e(this).val()];return r.Module.Filter.form.find("#slider-range").slider("values",l),!1}return!0}))}),"1"===i.moduleParams.keyword&&e("#"+i.domId+"-keyword").on("keypress",function(e){return 13!==e.keyCode||(r.Module.Filter.submitFormAjax(),!1)}),"1"===i.moduleParams.show_clear&&r.Module.Filter.form.find("#clear-btn").on("click",function(l){l.preventDefault(),r.Module.Filter.resetMode=!0,r.Module.Filter.form.find('input[type="checkbox"]').prop("checked",!1),r.Module.Filter.form.find('input[type="checkbox"]').each(function(){r.Module.Filter.checkClick(e(this))}),"1"===i.moduleParams.keyword&&r.Module.Filter.form.find("#"+i.domId+"-keyword").val(""),"1"===i.moduleParams.manufacturer&&(r.Module.Filter.form.find('input[name="keyword-manufacturer"]').val(""),r.Module.Filter.populateManufacturerOptions()),"1"===i.moduleParams.price&&(r.Module.Filter.form.find('input[name="redform[filterprice][min]"]').val(i.rangeMin),r.Module.Filter.form.find('input[name="redform[filterprice][max]"]').val(i.rangeMax),r.Module.Filter.rangeSlide(i.rangeMin,i.rangeMax,i.currentMin,i.currentMax,r.Module.Filter.submitFormAjax)),r.Module.Filter.resetMode=!1,r.Module.Filter.submitFormAjax(null)})},r.Module.Filter.checkList=function(){var i=[];r.Module.Filter.form.find("#manu #manufacture-list input").on("change",function(){i.push(e(this).val()),r.Module.Filter.submitForm(this)}),e('input[name="check_list"]').val(JSON.stringify(i))},r.Module.Filter.checkClick=function(r){!0===e(r).prop("checked")?e(r).prev(".icon").addClass("active"):e(r).prev(".icon").removeClass("active")},r.Module.Filter.rangeSlide=function(i,l,t,o,n){null===r.Module.Filter.priceSlider?(e.ui.slider.prototype.widgetEventPrefix="slider",r.Module.Filter.priceSlider=r.Module.Filter.form.find("#slider-range").slider({range:!0,min:i,max:l,step:1,values:[t,o],slide:function(e,i){r.Module.Filter.form.find('[name="redform[filterprice][min]"]').attr("value",i.values[0]),r.Module.Filter.form.find('[name="redform[filterprice][max]"]').attr("value",i.values[1])},change:function(){n&&"function"==typeof n&&(e('input[name="limitstart"]').val(0),n())}})):(r.Module.Filter.priceSlider.slider("option","min",i),r.Module.Filter.priceSlider.slider("option","max",l),r.Module.Filter.priceSlider.slider("values",[t,o]))},r.Module.Filter.submitFormAjax=function(){return!1===r.Module.Filter.resetMode&&e.ajax({type:"POST",url:r.RSConfig._("SITE_URL")+"index.php?option=com_redshop&task=search.findProducts",data:r.Module.Filter.form.serialize(),beforeSend:function(){e("#wait").css("display","block")},success:function(r){var i=e("#main #redshopcomponent");i.length||(i=jQuery("#redshopcomponent")),i.html(r),e("select").select2(),window.history.pushState("","",e(e.parseHTML(r)).find("#new-url").text())},complete:function(){e("#wait").css("display","none"),"1"===r.Module.Filter.options.moduleParams.restricted&&restricted(r.Module.Filter.form.serialize(),e('input[name="pids"]').val(),r.Module.Filter.options.moduleParams)}}),!1},r.Module.Filter.submitForm=function(){r.Module.Filter.form.find('input[name="limitstart"]').val(0),r.Module.Filter.submitFormAjax()},r.Module.Filter.populateManufacturerOptions=function(){var i=r.Module.Filter.options.manufacturers,l=r.Module.Filter.form.find('input[name="keyword-manufacturer"]').val(),t=[],o=e('input[name="check_list"]').val(),n=e.parseJSON(o);e.each(i,function(e,r){r.name.toLowerCase().indexOf(l.toLowerCase())>-1&&t.push(r)});var a="";e.each(t,function(r,i){if(Object.keys(i).length>0){var l="";-1!=e.inArray(i.manufacturer_id,n)&&(l='checked="checked"'),a+='<li style="list-style: none"><label>',a+='<span class="taginput" data-aliases="'+i.id+'">',a+='<input type="checkbox" '+l+' value="'+i.id+'" name="redform[manufacturer][]" />',a+="</span>",a+='<span class="tagname">'+i.name+"</span>",a+="</label></li>"}}),r.Module.Filter.form.find("#manu #manufacture-list").html(""),r.Module.Filter.form.find("#manu #manufacture-list").append(a),r.Module.Filter.checkList()}}(jQuery);